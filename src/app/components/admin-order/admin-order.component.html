<div class="container mt-4">

  <!-- Messages -->
  <div *ngIf="message" class="alert alert-success fw-bold">
    {{ message }}
  </div>

  <!-- Status Tabs -->
  <div class="mb-3">
    <button class="btn btn-success me-2" (click)="setFilter('')">All Orders</button>
    <button class="btn btn-danger me-2" (click)="setFilter('rejected')">Rejected Orders</button>
    <button class="btn btn-warning me-2" (click)="setFilter('pending')">Pending Orders</button>
    <button class="btn btn-info me-2" (click)="setFilter('conform')">Confirmed Orders</button>
  </div>

  <!-- Title based on filter -->
  <div class="text-center bg-primary text-white py-2 mb-3">
    <h1 class="h4 mb-0">
      {{ filterStatus ? (filterStatus === 'conform' ? 'Confirmed Orders' : (filterStatus | titlecase) + ' Orders') : 'All Orders' }}
    </h1>
  </div>

  <!-- Orders Table -->
  <div class="table-responsive">
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>ID</th>
          <th>Ordered By</th>
          <th>Payment Method</th>
          <th *ngIf="filterStatus !== 'pending'">Status</th>
          <th>Delivery Date</th>
          <th>Total Amount</th>
          <th>Ordered Products</th>
          <th *ngIf="filterStatus === 'pending'">Confirm</th>
          <th *ngIf="filterStatus === 'pending'">Reject</th>
          <th *ngIf="filterStatus === 'conform'">Print Label</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let order of filteredOrders">
          <td>{{ order.id }}</td>
          <td>{{ order.user.name }}</td>
          <td>{{ order.paymentMethod }}</td>
          <td *ngIf="filterStatus !== 'pending'">{{ order.status }}</td>
          <td>{{ order.deliveryDate }}</td>
          <td>{{ order.totalAmount }}</td>
          <td>
            <ul>
              <li *ngFor="let op of order.orderedProducts">
                {{ op.product.name }} Qty: {{ op.qty }}
              </li>
            </ul>
          </td>

         <!-- Confirm Button (for pending orders) -->
        <td *ngIf="filterStatus === 'pending'">
            <button class="btn btn-info btn-sm" (click)="confirmOrder(order.id)">Confirm Order</button>
        </td>

        <!-- Reject Button (for pending orders) -->
        <td *ngIf="filterStatus === 'pending'">
             <button class="btn btn-danger btn-sm" (click)="openRejectModal(order.id)">Reject Order</button>
        </td>

        <!-- Print Label Button (for confirmed orders) -->
        <td *ngIf="filterStatus === 'conform'">
            <button class="btn btn-warning btn-sm" (click)="printLabel(order.id)">Print Label</button>
        </td>

        </tr>
      </tbody>
    </table>
  </div>

</div>

<!-- Reject Order Modal -->
<div class="modal fade show" tabindex="-1" style="display: block;" *ngIf="rejectOrderId !== null">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Reject Order</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="cancelReject()"></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to reject order #{{ rejectOrderId }}?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="cancelReject()">Close</button>
        <button type="button" class="btn btn-danger" (click)="confirmReject()">Reject Order</button>
      </div>
    </div>
  </div>
  <div class="modal-backdrop fade show"></div>
</div>

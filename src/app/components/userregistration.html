<div class="nk-block-head nk-block-head-sm">
  <div class="nk-block-between">
    <div class="nk-block-head-content">
      <h3 class="nk-block-title page-title">
        {{isFormVisible ?(currentUserId ? 'Edit User' : 'Add New User') :('User List' | translate) }}
      </h3>

    </div>
    <div class="nk-block-head-content">
      <div class="toggle-wrap nk-block-tools-toggle">
        <a href="javascript:void(0)" class="btn btn-icon btn-trigger toggle-expand me-n1" data-target="more-options"
          (click)="expandContent()"><em class="icon ni ni-more-v"></em></a>
        <div class="toggle-expand-content" [class.d-block]="isExpanded" [class.d-none]="!isExpanded"
          data-content="more-options">
          <ul class="nk-block-tools g-3">
            <li>
              <div class="form-control-wrap">
                <div class="form-icon form-icon-right">
                  <em class="icon ni ni-search"></em>
                </div>
                <input type="text" class="form-control" id="default-04" [placeholder]="'Search' | translate"
                  [(ngModel)]="searchText" (keyup)="getList()">
              </div>
            </li>
            <li class="nk-block-tools-opt">
              <a class="btn  btn-primary d-md" (click)="openModal(templateAct)">{{ isFormVisible ? 'User List' :
                ('Add New User' | translate) }}</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="nk-block">
  <div class="nk-tb-list is-separate mb-3">
    <div class="card card-bordered">
      <ng-template #templateAct>
        <div cdkDrag class="modal-content draggable-modal">
          <div cdkDragHandle class="modal-header">
            <h4 class="modal-title pull-left">{{'Add User' | translate}}</h4>
            <a class="close" (click)="modalRef?.hide()">
              <em class="icon ni ni-cross"></em>
            </a>
          </div>
          <div class="modal-body">
            <form [formGroup]="registrationForm" (ngSubmit)="onSubmit()">
              <div class="row g-3">
                <input type="hidden" formControlName="id">
                <!-- Full Name -->
                <div class="col-md-4">
                  <label class="form-label">{{'Full Name' | translate}}</label>
                  <input type="text" class="form-control" formControlName="fullname">
                  <span *ngIf="registrationForm.get('fullname')?.invalid && registrationForm.get('fullname')?.touched"
                    class="text-danger">
                    {{'Full Name is required.' | translate}}
                  </span>
                </div>
                <!-- Username -->
                <div class="col-md-4">
                  <label class="form-label">{{'Username' | translate}}</label>
                  <input type="text" class="form-control" formControlName="username">
                  <span *ngIf="registrationForm.get('username')?.invalid && registrationForm.get('username')?.touched"
                    class="text-danger">
                    {{'Username is required.' | translate}}
                  </span>
                </div>
                <!-- Password -->
                <div class="col-md-4">
                  <label class="form-label">{{'Password' | translate}}</label>
                  <input type="password" class="form-control" formControlName="password">
                  <span *ngIf="registrationForm.get('password')?.invalid && registrationForm.get('password')?.touched"
                    class="text-danger">
                    {{' Password is required.' | translate}}
                  </span>
                </div>
                <!-- Confirm Password -->
                <div class="col-md-4">
                  <label class="form-label">{{'Confirm Password' | translate}}</label>
                  <input type="password" class="form-control" formControlName="cpassword">
                  <span
                    *ngIf="registrationForm.get('cpassword')?.errors?.['mismatch'] && registrationForm.get('cpassword')?.touched"
                    class="text-danger">
                    {{'Passwords do not match.' | translate}}
                  </span>
                </div>
                <!-- Email -->
                <div class="col-md-4">
                  <label class="form-label">{{'Email' | translate}}</label>
                  <input type="email" class="form-control" formControlName="email">
                  <span *ngIf="registrationForm.get('email')?.invalid && registrationForm.get('email')?.touched"
                    class="text-danger">
                    {{'Email is required.' | translate}}
                  </span>
                </div>
                <!-- Mobile -->
                <div class="col-md-4">
                  <label class="form-label">{{'Mobile' | translate}}</label>
                  <input type="tel" class="form-control" formControlName="mobile">
                  <span *ngIf="registrationForm.get('mobile')?.invalid && registrationForm.get('mobile')?.touched"
                    class="text-danger">
                    {{' Mobile is required.' | translate}}
                  </span>
                </div>

                <div class="col-md-4">
                  <label class="form-label">{{'User Type' | translate}}</label>
                  <select class="form-select" formControlName="usertype" #ut (change)="getAgencyType(ut.value)">
                    <option value="" disabled>Select One..</option>
                    <option *ngFor="let type of usertypes" [value]="type.id">{{ type.nameen }}</option>
                  </select>
                  <span *ngIf="registrationForm.get('userType')?.invalid && registrationForm.get('userType')?.touched"
                    class="text-danger">
                    User type must be selected.
                  </span>
                </div>
                <!-- Agency ID -->
                <div class="col-md-4">
                  <label class="form-label">{{pelabel}}</label>
                  <select class="form-select" formControlName="agencyid">
                    <option value="" disabled>Select One...</option>
                    <option *ngFor="let type of agencies" [value]="type.id">{{ type.nameen }}</option>
                  </select>
                  <span *ngIf="registrationForm.get('agencyid')?.invalid && registrationForm.get('agencyid')?.touched"
                    class="text-danger">
                    Enterprise must be selected.
                  </span>
                </div>
                <!-- User Type -->

                <!-- User Status -->
                <div class="col-md-4">
                  <label class="form-label">{{'User Status' | translate}}</label>
                  <select class="form-select" formControlName="userstatus">
                    <option value="1">{{'Approved' | translate}}</option>
                    <option value="0">{{'Disabled' | translate}}</option>
                  </select>
                </div>
              </div>
              <div class="mt-3">
                <button type="submit" class="btn btn-success">
                  {{ currentUserId ? ('Update' | translate) : ('Submit' | translate) }}
                </button>
                <button type="button" class="btn btn-outline-primary ms-2" (click)="resetForm()">{{'Reset' |
                  translate}}</button>
              </div>
            </form>

          </div>
        </div>
      </ng-template>
    </div>
  </div>
  <!-- Table content -->
  <div *ngIf="!isFormVisible" style="background-color: transparent;">
    <div class="card-inner">
      <div class="table-responsive">
        <table class="table nk-tb-list is-separate table-striped">
          <thead class="thead-dark">
            <tr class="nk-tb-item nk-tb-head">
              <th class="nk-tb-col">{{'Full Name' | translate}}</th>
              <!-- <th class="nk-tb-col">Email</th> -->
              <th class="nk-tb-col">{{'Username' | translate}}</th>
              <th class="nk-tb-col">{{'Public Enterprise' | translate}}</th>
              <th class="nk-tb-col">{{'Mobile' | translate}}</th>
              <th class="nk-tb-col nk-tb-col-tools">
                <ul class="nk-tb-actions gx-1 my-n1">
                  <a class="btn btn-icon">
                    <em class="icon ni ni-more-h"></em>
                  </a>
                </ul>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of userLists;let i=index;" class="nk-tb-item">
              <td class="nk-tb-col">
                <div class="user-card">
                  <div class="user-avatar {{bgClasses[i]}}">
                    <span>{{ getInitial( user.fullname) }}</span>
                  </div>
                  <div class="user-info">
                    <span class="tb-lead"> {{user.fullname }} <span
                        class="dot dot-success d-md-none ms-1"></span></span>
                    <span>{{user.email}}</span>
                  </div>
                </div>
              </td>
              <!-- <td class="nk-tb-col">{{ user.email }}</td> -->
              <td class="nk-tb-col">{{ user.username }}</td>
              <td class="nk-tb-col">{{ user.agency }}</td>
              <td class="nk-tb-col">{{ user.mobile }}</td>
              <td class="nk-tb-col nk-tb-col-tools">
                <ul class="nk-tb-actions gx-1 my-n1">
                  <li>
                    <div class="dropdown">
                      <a href="#" class="dropdown-toggle btn btn-icon btn-trigger me-n1" data-bs-toggle="dropdown"><em
                          class="icon ni ni-more-h"></em></a>
                      <div class="dropdown-menu dropdown-menu-end">
                        <ul class="link-list-opt no-bdr">
                          <li>
                            <a href="javascript:void(0)"><em class="icon ni ni-eye"></em><span>{{'View' |
                                translate}}</span></a>
                          </li>
                          <li>
                            <a href="javascript:void(0)" (click)="editUser(user.id);openModal(templateAct)"><em
                                class="icon ni ni-edit"></em><span>{{'Edit' | translate}}</span></a>
                          </li>
                          <li>
                            <a href="javascript:void(0)" (click)="deleteUser(user.id)"><em
                                class="icon ni ni-trash"></em><span>{{'Delete' | translate}}</span></a>
                          </li>
                        </ul>
                      </div>
                    </div>
                  </li>
                </ul>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- Pagination Controls -->

      <div class="card shadow">   
        <div class="container-fluid mb-1">
          <div class="nk-block-between-md g-3">
            <div class="g">
              <div class="pagination-container d-flex justify-content-center mt-1">
                <pagination [rotate]="true" [maxSize]="5" [totalItems]="pagination.total"
                  [(ngModel)]="pagination.currentPage" [boundaryLinks]="true" [itemsPerPage]="pagination.perPage"
                  (pageChanged)="paginatedData($event)" previousText="&lsaquo;" nextText="&rsaquo;" firstText="&laquo;"
                  lastText="&raquo;">
                </pagination>
              </div>
            </div>
            <div class="g">
              <div class="nk-block-between" *ngIf="pagination.total > 0">
                <div class="record-info">
                  Showing {{ getStartRecord() }} to {{ getEndRecord() }} of {{
                  pagination.total }}
                  records
                </div>
              </div>
            </div>
            <div class="g">
              <div class="pagination-goto d-flex justify-content-center mt-1">
                <label>{{'Show' | translate}}
                  <select class="form-select d-inline w-auto" [(ngModel)]="entriesToShow" (change)="getList()">
                    <option *ngFor="let num of [10, 20, 50, 100]" [value]="num">{{ num }}</option>
                  </select>
                  {{'entries' | translate}}
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>